UPGRADING FROM VADMIN 1.0.x
---------------------------

This document is meant to help people who are migrating from older
versions of Vadmin to a newer release.  The upgrade process is 
simple enough, however, make sure you follow this document 
meticulously, or the upgrade can break your Vadmin system.

[NOTE: You must be running Vadmin with SquirrelMail 1.4.0 or above. 
Vadmin no longer works with the SquirrelMail 1.2.x series.]


1. Look at your vadmin_config.php and migrate the settings to 
   conf/vadmin.conf.php.  Things to keep in mind:

   * All paths should be full paths, not relative ones.
   * If your $VADMIN_DIR is /var/vadmin, it is strongly suggested
     to move it to /var/lib/vadmin for FHS compliance 
     (mv /var/vadmin /var/lib/vadmin).  Otherwise, set [storage]->dir
     accordingly.
   * VADMIN_CROSS_ADMIN_AUTH_METHOD is now [auth]->method.
   * VADMIN_CROSS_ADMIN_FORCE_HTTPS is now [auth]->force_https.
   * VADMIN_MAX_ORG_IMAGE_SIZE_KB is deprecated and now set per-domain.
   * VADMIN_DELIMITERS are in vmailmgr.conf.php, but changing these is 
     not encouraged, unless you have chosen custom values for your 
     VMailMgr setup.

2. Uncomment the [upgrade] section in vadmin.conf.php.

3. Find out what your apache process runs as -- user "nobody" on most 
   BSDs, or user "apache" on Red Hat Linux.  Change the ownership of 
   your Vadmin storage directory (usually /var/lib/vadmin, but whatever 
   you set [storage].dir to in vadmin.conf.php) to that user.
   E.g.:
   chown -R apache /var/lib/vadmin

4. Locate your apache.inc that contains MCRYPT_ALGO and CRYPTO_HASH_LINE
   and change it so the <Directory> settings point not to plugins/vadmin
   directory, but to the whole squirrelmail directory (required with the
   new codebase, see SECURITY for more info).
   E.g.:
   if it used to be <Directory /usr/share/squirrelmail/plugins/vadmin>, then
   it becomes <Directory /usr/share/squirrelmail>.

5. Make sure your PHP is at least version 4.1 and compiled with DBA/GDBM
   support (most prebuilt PHP binaries ship with gdbm enabled).  If you have
   built your own, check if you have compiled it with "--enable-dba
   --with-gdbm" and if not, recompile with these options set.

6. Back up your Vadmin storage directory (usually /var/lib/vadmin, but 
   whatever you set [storage].dir to in vadmin.conf.php).  Alternatively, 
   move it to something such as /var/lib/vadmin-old and create a new 
   /var/lib/vadmin directory, setting appropriate permissions.  Using this
   scheme, you'd then specify /var/lib/vadmin-old in the [upgrade].dir 
   setting in vadmin.conf.php and set "cleanup" to "no" to preserve 
   vadmin-old untouched.

7. Restart apache.

8. NOTE: The "Admin" link is no longer displayed along the top by default.  
   To get to the administrative interface, go to "Options" and find the
   "Administrator Interface" section.

That should be all that is needed.  If your setup doesn't work after this, 
please email squirrelmail-plugins@lists.sf.net for support with [Vadmin] in 
the subject.  As always, you must include as many details as possible about 
the system you are attempting to install the plugin on, along with the 
configuration settings you made in each of the vadmin configuration files.

